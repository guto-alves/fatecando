<!DOCTYPE html>
<html xmlns:th="www.thymeleaf.org"
	th:replace="~{fragments/layout :: base(${topic.name}, ~{::body}, _, _, ~{::style})}">
<head>
<meta charset="utf-8">

<style type="text/css">
#finish-btn.active {
	background-color: #198754;
	border-color: #198754
}
</style>
</head>
<body>
	<!-- Topic info -->
	<div class="card mt-3">
		<div class="card-body">
			<h2 class="card-title text-center" th:text="${topic.name}">Topic Name</h2>
			<p th:text="${topic.description}"></p>

			<div class="d-flex justify-content-end">
				<button id="finishButton" class="btn btn-outline-success mr-3"
					th:classappend="${topic.user.finished} ? 'active'">
					<i class="fa fa-check"></i>
					<span th:text="${topic.user.finished} ? 'Marcado como concluído' : 'Marcar como concluído'">Marcar
						como concluído</span>
				</button>

				<div class="btn-group rounded-start" role="group" aria-label="Like toggle button">
					<input type="checkbox" class="btn-check" id="likeButton" autocomplete="off"
						th:checked="${topic.user.liked}">
					<label class="btn btn-outline-primary p-2" for="likeButton">
						Curtir <i class="fa fa-thumbs-up"></i>
					</label>
				</div>
				<span id="totalLikes"
					class="fw-bolder text-primary border border-1 border-start-0 border-primary p-2 rounded-end"
					th:text="${topic.likes}"></span>
			</div>
		</div>
	</div>

	<!-- Content -->
	<div class="card mt-3">
		<div class="card-body" id="content"></div>
	</div>

	<!-- Quiz -->
	<div class="card mt-3 bg-danger">
		<div class="card-body">
			<h4 class="card-title text-light" th:text="'Quiz - ' + ${topic.name}">Quiz</h4>

			<button id="startQuiz" class="btn btn-outline-light btn-lg form-control mb-3">Iniciar Quiz</button>

			<div id="quizResult" class="p-3 text-center text-danger bg-white rounded" style="display: none;">
				<span class="h4">Resultado do Quiz</span>
				<br>
			</div>

			<div id="questionContainer" class="p-2 bg-white rounded" style="display: none;">
				<span id="questionIndex" class="fw-bold">- Question 1 de 3</span>
				<hr>

				<h5 id="question">Os sistemas de informacao estao evoluindo de acordo com as tendencias de mercado,
					eles proporcionam ganhos imensuraveis para as organizacoes no que diz respeito a ganho de espaco
					organizacao dos arquivos e informacoes e com isso a liberdade de acesso, representada pela possibilidade
					de trabalhar com os dados oferecidos pelo sistema da melhor forma possivel. Assim sendo, podemos concluir
					que:</h5>
				<br>

				<!-- Answers -->
				<div class="form-check mb-3">
					<input class="form-check-input" type="radio" name="alternativeRadio" id="alternativeRadio1">

					<label class="form-check-label" for="alternativeRadio1">Alternativa 1</label>
				</div>

				<div class="form-check mb-3">
					<input class="form-check-input" type="radio" name="alternativeRadio" id="alternativeRadio2">
					<label class="form-check-label" for="alternativeRadio2"> Alternativa 2</label>
				</div>
			</div>

			<div class="row mt-3">
				<div class="col">
					<button id="finishQuiz" type="button" class="btn btn-secondary btn-lg form-control"
						style="display: none;">Finalizar</button>
				</div>

				<div class="col">
					<button id="answerQuestion" type="button" class="btn btn-outline-light btn-lg form-control"
						style="display: none;">Responder</button>
				</div>

				<div class="col">
					<button id="nextQuestion" type="button" class="btn btn-outline-light btn-lg form-control"
						style="display: none;" onclick="nextQuestion()">Próxima Pergunta</button>
				</div>
			</div>
		</div>
	</div>

	<script type="text/javascript" th:inline="javascript">
		$('#content').html(/*[[${topic.htmlContent}]]*/null);
		let questions = /*[[${questions}]]*/null;

		let waiting = false;

		$('#likeButton').click(function() {
			$.post(location.href + '/like');

			let liked = $(this).prop('checked');

			let totalLikes = parseInt($('#totalLikes').text());
			$('#totalLikes').text(liked ? totalLikes + 1 : totalLikes - 1);
		});

		$('#finishButton').click(function() {
			if (waiting) {
				return false;
			}

			waiting = true;

			let button = $(this);
			let buttonLabel = $('#finishButton span');

			buttonLabel.text('Aguarde ...');

			$.post(location.href + '/finished').done(function() {
				if (button.hasClass('active')) {
					button.removeClass('active');
					buttonLabel.text("Marcar como concluído");
				} else {
					button.addClass('active');
					buttonLabel.text("Marcado como concluído");
				}

				waiting = false;
			}).fail(function() {
				button.removeClass('active');
				buttonLabel.text("Erro ao marcar tópico como concluído!");
			});
		});
	</script>

	<script type="text/javascript" th:src="@{/js/topic-details.js}"></script>
</body>
</html>